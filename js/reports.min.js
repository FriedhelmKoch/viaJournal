/*!
 * 
 * Copyright (c) 2017 Friedhelm Koch
 *
 * This file is part of viaLinked Project. It is subject to the license terms 
 * in the LICENSE file found in the top-level directory of this distribution 
 * and at http://www.viaLinked.com/license.html. 
 * No part of viaLinked Project, including this file, may be copied, modified, 
 * propagated, or distributed except according to the terms contained in the 
 * LICENSE file.
 *
 */
var viaJournalDB_085,recFonds,urlPara,transVonEmail=[],offZahlungPers=[],refCurrency="",journalName="",journalLeaderName="",LZ="  ",LZ4=LZ+LZ,LZ10="               ";$(document).ready(function(){return iOSversion(),openDB(),showReports(),$(".Email").click(function(){var e=[],n="",r="",a="",t="",i="",o="",s=[],l=viaJournalDB_085.query("Journal");for(var h=0 in l)l[h].code==urlPara[1]&&(e=l[h].journalPersonen);var u=viaJournalDB_085.query("Konten");for(var d=0 in u)for(var h=0 in e)if(e[h]==u[d].code){var c=u[d].ktoBemerkung?" ("+u[d].ktoBemerkung+")":"",a=u[d].ktoTel?"Telefon: "+u[d].ktoTel+"</br>":"",t=u[d].ktoTel?LZ+"Telefon: "+u[d].ktoTel+"\n":"";n+='<span style="font-size:.8em">'+u[d].ktoVorName+" "+u[d].ktoNachName+c+"</br>"+a+"Bank: "+u[d].ktoBank+"<br />BIC/BLZ: "+u[d].ktoBIC+"<br />IBAN/Kto: "+u[d].ktoIBAN+'</span><hr size="1px" align="left" width="50%" color="#c0c0c0" noshade>',r+=u[d].ktoVorName+" "+u[d].ktoNachName+c+"\n"+t+LZ+"Bank: "+u[d].ktoBank+"\n"+LZ+"BIC/BLZ: "+u[d].ktoBIC+"\n"+LZ+"IBAN/Kto: "+u[d].ktoIBAN+"\n----------------------\n"}for(var d=0 in u)u[d].ktoIBAN&&"Personen"!=u[d].ktoIdent&&(n+='<span style="font-size:.8em">'+u[d].ktoName+"<br />Kto-Inhaber: "+u[d].ktoName+"<br />Bank: "+u[d].ktoBank+"<br />BIC/BLZ: "+u[d].ktoBIC+"<br />IBAN/Kto: "+u[d].ktoIBAN+'</span><hr size="1px" align="left" width="50%" color="#c0c0c0" noshade>',r+=u[d].ktoName+"\n"+LZ+"Kto-Inhaber: "+u[d].ktoName+"\n"+LZ+"Bank: "+u[d].ktoBank+"\n"+LZ+"BIC/BLZ: "+u[d].ktoBIC+"\n"+LZ+"IBAN/Kto: "+u[d].ktoIBAN+"\n----------------------\n");var h=0;for(var d=0 in offZahlungPers){var b=offZahlungPers[d].split(";");0!=parseFloat(round(b[0],2))&&(s[h]=[],s[h]={betrag:parseFloat(b[0]),name:b[1]},h++)}s.sort(function(e,n){var e=e.betrag,n=n.betrag;return e==n?0:e>n?-1:1});var g=s.length-1,h=0;do if(parseFloat(s[g].betrag)<=0){var m=parseFloat(s[g].betrag)+parseFloat(s[h].betrag);if(0>m){i+="<li>"+s[g].name+" zahlt: "+number_format(s[h].betrag,2,",",".")+" "+refCurrency+" an: "+s[h].name+"</li>",o+="- "+s[g].name+" zahlt: "+number_format(s[h].betrag,2,",",".")+" "+refCurrency+" an: "+s[h].name+"\n";var p=s[g].betrag;s[g].betrag=m,s[h].betrag=p+parseFloat(s[h].betrag)-m,h++}else{i+="<li>"+s[g].name+" zahlt: "+number_format(-1*s[g].betrag,2,",",".")+" "+refCurrency+" an: "+s[h].name+"</li>",o+="- "+s[g].name+" zahlt: "+number_format(-1*s[g].betrag,2,",",".")+" "+refCurrency+" an: "+s[h].name+"\n";var p=s[g].betrag;s[g].betrag=parseFloat(s[g].betrag)-parseFloat(s[g].betrag),s[h].betrag=parseFloat(s[h].betrag)+p,g--}}while(g>h);anschreiben_txt="Liebes Team,\nanbei die Abrechnung zu: *** "+journalName+' ***\n\nIm oberen Teil der Abrechnung seht ihr in einer Übersicht alle Ausgaben und Einnahmen für alle Gruppen- und Personenkonten, sowie deren Überschüsse (Saldi).Besteht ein "Überschuss", sind also die Ausgaben ungleich der Einnahmen, dann ist das Konto: "Soll zu Haben" nicht ausgeglichen. Ein positiver Überschuss (auch Soll-Saldo) bedeutet, dass mehr ausgegeben wurde, als eingenommen wurde.Die noch "offene Zahlung" ergibt sich aus den "Ausgaben pro PAX" minus dem persönlichen "Überschuss". Eine negative offene Zahlung bedeutet demnach, dass diejenige Person noch eine Zahlung in der entsprechenden Höhe zu leisten hat!\n\nDiejenige Person, die das Kassenbuch verwaltet, hat als Ausnahme den Überschuss der Gruppen-/Gemeinschaftskonten übernommen. Dieser Überschuss verrechnet sich natürlich mit seiner persönlichen, entweder positiven oder negativen offenen Zahlung. Dies verringert oder erhöht ggf. seine Zahlung die er noch zu leisten, oder zu bekommen hat. Die Zahlungen können mit einer oder mehreren Personen verrechnet werden die eine positive offene Zahlung (also zu viel gezahlt) hat.\n\nWurden für die einzelnen Teilnehmer des Kassenbuches Bankdaten hinterlegt, finden die sich am Ende dieser Abrechnung. Im weiteren Verlauf der Abrechnung befinden sich Übersichten über die einzelnen Ausgabe-, Einnahmenkonten und deren konsolidierten Sachaufwendungen. Weiter unten sind dann noch einmal alle Einzelbuchungen aufgeführt.\n\nDer Zahlungsplan sieht somit folgendermaßen aus:\n'+o.replace(/&/gi,"+")+"\nSollte es weitere Fragen dazu geben, bitte Feedback an mich.\n\nDanke und beste Grüße,\n"+journalLeaderName.replace(/&/gi,"+")+"\n\n===============================\n"+$("#mailReport_Header").text().replace(/&/gi,"+")+"*** KONTEN ***\n===============================\nAusgaben\n----------------------\n"+$("#mailReport_KontenAusgaben").text().replace(/&/gi,"+")+"----------------------\nEinnahmen\n----------------------\n"+$("#mailReport_KontenEinnahmen").text().replace(/&/gi,"+")+"----------------------\nSachaufwand\n----------------------\n"+$("#mailReport_KontenSachen").text().replace(/&/gi,"+")+"\n===============================\n*** JOURNAL (chronologisch) ***\n===============================\n"+$("#mailReport_reportJournal").text().replace(/&/gi,"+")+"\n===============================\n*** Teilnehmer Bankinfos ***\n===============================\n"+r.replace(/&/gi,"+"),anschreiben='<span style="font-size:.8em"><p>Liebes Team,</p><p>anbei die Abrechnung zu: "'+journalName+'".</p><p>Im oberen Teil der Abrechnung seht ihr in einer Übersicht alle Ausgaben und Einnahmen für alle Gruppen- und Personenkonten, sowie deren Überschüsse (Saldi).</p><p>Besteht ein "Überschuss", sind also die Ausgaben ungleich der Einnahmen, dann ist das Konto: "Soll zu Haben" nicht ausgeglichen. Ein positiver Überschuss (auch Soll-Saldo) bedeutet, dass mehr ausgegeben wurde, als eingenommen wurde.</p><p>Die noch "offene Zahlung" ergibt sich aus den "Ausgaben pro PAX" minus dem persönlichen "Überschuss". Eine negative offene Zahlung bedeutet demnach, dass diejenige Person noch eine Zahlung in der entsprechenden Höhe zu leisten hat!</p><p>Diejenige Person, die das Kassenbuch verwaltet, hat als Ausnahme den Überschuss der Gruppen-/Gemeinschaftskonten übernommen. Dieser Überschuss verrechnet sich natürlich mit seiner persönlichen, entweder positiven oder negativen offenen Zahlung. Dies verringert oder erhöht ggf. seine Zahlung die er noch zu leisten, oder zu bekommen hat. Die Zahlungen können mit einer oder mehreren Personen verrechnet werden die eine positive offene Zahlung (also zu viel gezahlt) hat.</p><p>Wurden für die einzelnen Teilnehmer des Kassenbuches Bankdaten hinterlegt, finden die sich am Ende dieser Abrechnung.</p><p>Im weiteren Verlauf der Abrechnung befinden sich Übersichten über die einzelnen Ausgabe-, Einnahmenkonten und deren konsolidierten Sachaufwendungen. Weiter unten sind dann noch einmal alle Einzelbuchungen aufgeführt.</p><p>Damit haben zu zahlen:</br><ul>'+encodeURIComponent(i)+"</ul><p>Sollte es weitere Fragen dazu geben, bitte Feedback an mich.</p><p>Danke und beste Grüße,</br>"+journalLeaderName+'</br></br></p><hr size="1px" align="left" width="50%" color="#c0c0c0" noshade></span>';var f=($("#mailHeader").html(),"Abrechnung für: "+journalName);"<style>body { font:12pt/110% Arial; font-size:1.0em; }td { float:left; text-align:left; font-size: 1.3em;}/* Header, Content, Footer */	.ui-header, .ui-content, .ui-controlgroup, .ui-footer, .ui-controlgroup {	font-size: 1.4em;}</style><p>"+anschreiben+'<table border="0" width="100%" cellspacing="0" cellpadding="0"><tr><td>'+$("#mailArea").html()+'</td></tr><tr><td><p style="font-size:1.2em"><b>Bankinformationen</b></p>'+n+'</td></tr><tr><td style="background-image:url(http://viajournal.vialinked.com/img/viaJournal_at_AppStore_Tagline_horizontal.png); background-repeat:no-repeat; height:42px;" ></td></tr></table></p>',window.location.href="mailto:"+transVonEmail+"?subject="+f+"&body="+encodeURI(anschreiben_txt)}),$(".link2journal").bind("click",function(){var e,n=$(location).attr("href").split("?"),r=viaJournalDB_085.query("Journal");for(var a=0 in r)r[a].code==n[1]&&(e=a);window.location.href="./index.html?"+e}),!1});
